
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Velocity Control Loop Tuning &#8212; dc_motor_el7342 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to dc_motor_el7342’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="velocity-control-loop-tuning">
<h1>Velocity Control Loop Tuning<a class="headerlink" href="#velocity-control-loop-tuning" title="Permalink to this headline">¶</a></h1>
<p>With the motor configuration set, the YT Scope project ready, we can now focus on the tuning part of the procedure.</p>
<p>The Velocity Control Loop will be managed by the EL7342, the input velocity is managed by the NC. We will first focus on the EL7342 tuning.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">REMINDER :  you  The tuning can be affected by the cycle time associated to the NC. It is recommended  to set this task to 1 ms before any tuning,  for better results and less oscillations.  Go to the “Motor and software configuration” chapter II part 1 to set the correct cycle time.</p>
</div>
<div class="section" id="configurating-the-mode">
<h2>Configurating the Mode<a class="headerlink" href="#configurating-the-mode" title="Permalink to this headline">¶</a></h2>
<p>To have our EL7342 working as a velocity control loop, we have to setup some parameters in the Process Data and the CoE Online. Left click on the right Terminal EL7342 (if you have multiple), and go in the Process Data window.</p>
<a class="reference internal image-reference" href="_images/mode_config.png"><img alt="_images/mode_config.png" src="_images/mode_config.png" style="width: 600px;" /></a>
<p>In the Predefined PDO Assignment, select the Velocity control compact with info data. It will turn on all the PDO assignment needed for velocity control  plus the PDO needed for the info data which can be assigned, for instance, to the curent command.</p>
<a class="reference internal image-reference" href="_images/pdo_assign.png"><img alt="_images/pdo_assign.png" src="_images/pdo_assign.png" style="width: 600px;" /></a>
<p>In the CoE Online window, look for the Operation mode located in either 8022:01 register if you are using the Channel 1, or 8032:01 if you use the Channel 2. Set the mode to Automatic. In this mode, the EL7342 will automatically be set to the Velocity Control Compact with info data that has been set in the process data.
Activate the new configuration with</p>
<img alt="_images/activate_button.png" src="_images/activate_button.png" />
</div>
<div class="section" id="tuning-with-ziegler-nichols">
<h2>Tuning with Ziegler-Nichols<a class="headerlink" href="#tuning-with-ziegler-nichols" title="Permalink to this headline">¶</a></h2>
<p>To tune our motor, we will be using the Ziegler-Nichols method. In the CoE Online, at the register 8023:0 or 8033:0 depending on the channel used, you will find the Kp, Ki and Kd factor of the velocity control loop. Respectively, 8023:01 8023:02 and 8023:08 (or 8033:01 8033:02 and 8033:08 if channel 2 is used).</p>
<img alt="_images/dcm_8023.png" src="_images/dcm_8023.png" />
<p><strong>Start by setting both Ki and Kd to 0.</strong></p>
<p>The Ziegler-Nichols method’s first step is to find the gain Kp ultimate to which the motor is no longer stable, and start oscillating.
Increase the Kp factor, <strong>to update the changes, disable and enable again the controller on the NC panel.</strong></p>
<img alt="_images/nc_startup.png" src="_images/nc_startup.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Reminder : A shortcut to the NC panel and NC functions is available on the EL7342 window.
Common problem : Sometimes, enabling controller by clicking on it will not actually enable the motion. Click instead on All to fix the issue.
Disabling the motion while the motor is moving will send the Error 16992 (0x4260), click on the Reset button F8 of the NC panel to reset it</p>
</div>
<p>Once the changes are updated, go in the function panel :</p>
<img alt="_images/function_pan.png" src="_images/function_pan.png" />
<p>Use the Velo Step Sequence function to send velocity commands to the motor. <strong>This function is the only way to send a Velocity command directly to the module velocity control loop.  Other functions go through the position control loop of the NC and thus, will change the gain Kp ultimate.</strong></p>
<p>The velocity command is sent to the EL7342 through a 16 bits integer (with one bit for the sign). The NC task is using the reference velocity parameter to scale the input velocity (in user units) to the 16 bits velocity command :
e.g. if the reference velocity is 2 mm/s and a command of 1mm/2 is triggered, the NC task will send a command of  $2^15/2 = 16384$ .</p>
<p>Create a YT chart to display both the actual velocity and the set velocity to visualize your motor’s behavior.</p>
<div class="figure" id="id1">
<img alt="_images/scope1.png" src="_images/scope1.png" />
<p class="caption"><span class="caption-text"><em>Actual Velocity</em> (blue)  and <em>Set Velocity</em> (green) in mm/s of an oscillating motor M112-2DG1 on a YT Chart on a Velo Step Sequence function</span></p>
</div>
<p>In our example, the motor started being unstable at Kp = 1200. Our gain Kp ultimate (Ku) is 1200.
Using the YT Chart, zoom on the oscillations to measure the oscillation frequency.
Reminder : Use the zoom tool to zoom on the oscillations and click it once to do an automatic Y zoom !</p>
<div class="figure" id="id2">
<img alt="_images/scope2.png" src="_images/scope2.png" />
<p class="caption"><span class="caption-text">Zoomed in  <em>Actual Velocity</em> (blue)  and <em>Set Velocity</em> (green) in mm/s of an oscillating motor M112-2DG1 on a YT Chart on a Velo Step Sequence function</span></p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>You can click on the the tip of two oscillations to read the time t !</p>
<p class="last"><em>Actual Velocity</em> (blue)  and <em>Set Velocity</em> (green) in mm/s of an oscillating motor M112-2DG1 on a YT Chart on a Velo Step Sequence function</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">dc_motor_el7342</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Velocity Control Loop Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configurating-the-mode">Configurating the Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-with-ziegler-nichols">Tuning with Ziegler-Nichols</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to dc_motor_el7342’s documentation!</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Romain Bouche.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/velocity_control_loop.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>